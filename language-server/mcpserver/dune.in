(library
 (name mcpBase_lib)
 (public_name vsrocq-language-server.mcpBase)
 (modules mcpBase)
 (preprocess
   (staged_pps ppx_yojson_conv))
 (libraries yojson))

(library
 (name vsrocqTools_lib)
 (public_name vsrocq-language-server.vsrocqTools)
 (modules vsrocqTools)
 (preprocess
   (staged_pps ppx_yojson_conv))
 (libraries yojson mcpBase_lib))

(library
 (name mcpArgs)
 (public_name vsrocq-language-server.mcpArgs)
 (modules args)
 (preprocess
   (pps ppx_optcomp -- -cookie "ppx_optcomp.env=env ~rocq:(Defined \"%{coq:version.major}.%{coq:version.minor}\")"))
 (libraries @@ROCQ_RUNTIME@@.sysinit dm))

(library
 (name mcpserver)
 (public_name vsrocq-language-server.mcpserver)
 (modules mcpPrinting mcpManager)
 (libraries yojson @@ROCQ_RUNTIME@@.sysinit @@ROCQ_RUNTIME@@.vernac lsp sel dm protocol mcpBase_lib vsrocqTools_lib mcpArgs))

(executable
 (name vsrocqmcp)
 (public_name vsrocqmcp)
 (modules vsrocqmcp)
 (flags -linkall)
 (package vsrocq-language-server)
 (preprocess (pps ppx_optcomp -- -cookie "ppx_optcomp.env=env ~rocq:(Defined \"%{coq:version.major}.%{coq:version.minor}\")"))
 (libraries @@ROCQ_RUNTIME@@.sysinit @@ROCQ_RUNTIME@@.tactics sel yojson dm lsp mcpserver mcpArgs))
